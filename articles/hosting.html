<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="grover">
<title>Hosting a grover API • grover</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Hosting a grover API">
<meta property="og:description" content="grover">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">grover</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.8</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/client-usage.html">Accessing raw mass spectrometry data from a grover API</a>
    <a class="dropdown-item" href="../articles/hosting.html">Hosting a grover API</a>
    <a class="dropdown-item" href="../articles/introduction.html">Introduction to grover</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/jasenfinch/grover/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="hosting_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Hosting a grover API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jasenfinch/grover/blob/HEAD/vignettes/hosting.Rmd" class="external-link"><code>vignettes/hosting.Rmd</code></a></small>
      <div class="d-none name"><code>hosting.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette outlines the steps required for hosting a web API for providing web access to a mass spectrometry data repository. This includes the repository structure, specifying the host configuration, running the API and request logging.</p>
<p>To get started we can first load the <code>grover</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jasenfinch.github.io/grover/">grover</a></span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="data-repository-structure">Data repository structure<a class="anchor" aria-label="anchor" href="#data-repository-structure"></a>
</h2>
<p>The structure of the data repository should consist of a hierarchy of directories within a central data repository directory. The structure is outlined below.</p>
<pre><code> [34mrepository [39m
└── [34minstrument [39m
   └── [34mexperiment [39m
      └── [32msample.raw [39m</code></pre>
<p>Within the central data repository directory are instrument directories specifying the mass spectrometers from which the data were generated. Within these instrument directories, the data should be organised into directories for each experiment. The experiment directories should then contain the <code>.raw</code> mass spectrometry data files and any other associated files such meta information or instrument methods.</p>
</div>
<div class="section level2">
<h2 id="configuration">Configuration<a class="anchor" aria-label="anchor" href="#configuration"></a>
</h2>
<p>In order to activate the API, we first need to specify the host details. This can be done in two ways. The primary method is through the use of a configuration file that can then be parsed and specified when the API is activated. This should be in YAML format and have the structure shown below:</p>
<pre><code>host: 127.0.0.1
port: 8000
auth: 1234
repository: ./data</code></pre>
<p>This specifies the host address, the port, and authentication key for data security and the host system directory path to the data repository.</p>
<p>The package contains an example file that we can parse here using the <code><a href="../reference/readGrover.html">readGrover()</a></code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grover_host</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readGrover.html">readGrover</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'grover_host.yml'</span>,package <span class="op">=</span> <span class="st">'grover'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>This returns an S4 object of class <code>GroverHost</code> that contains the API host information. The host information can be viewed by printing the object:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">grover_host</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co"><span style="color: #0000BB;">#&gt; Grover Information</span></span>
<span class="co"><span style="color: #0000BB;">#&gt; </span></span>
<span class="co"><span style="color: #0000BB;">#&gt; </span>Host:        127.0.0.1 </span>
<span class="co">#&gt; Port:         8000 </span>
<span class="co">#&gt; Authentication:   1234 </span>
<span class="co">#&gt; Repository:   ./data</span></code></pre></div>
<p>The second method, and the method that will be used for this example, is to specify the host details directly using the <code><a href="../reference/grover.html">grover()</a></code> function like the following:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grover_host</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grover.html">grover</a></span><span class="op">(</span>host <span class="op">=</span> <span class="st">"127.0.0.1"</span>,
                     port <span class="op">=</span> <span class="fl">8000</span>,
                     auth <span class="op">=</span> <span class="st">"1234"</span>,
                     repository <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">'repository'</span>,
                                              package <span class="op">=</span> <span class="st">'grover'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>This enables us to host the example data repository included in the package.</p>
</div>
<div class="section level2">
<h2 id="running-the-api">Running the API<a class="anchor" aria-label="anchor" href="#running-the-api"></a>
</h2>
<p>The API can be activated using <code><a href="../reference/groverAPI.html">groverAPI()</a></code>. For the purposes of this example, the <code>background</code> argument will also be specified as <code>TRUE</code> to enable the API to be run in a background process. This will enable us to interact with the API without having to move to an alternative R console. Run the following to start the API:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">api</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/groverAPI.html">groverAPI</a></span><span class="op">(</span><span class="va">grover_host</span>,
                 background <span class="op">=</span> <span class="cn">TRUE</span>,
                 log_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">'/logs'</span><span class="op">)</span>,
                 temp_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">'/temp'</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in normalizePath(log_dir): path[1]="/tmp/Rtmp9HOVug/logs": No such file</span>
<span class="co">#&gt; or directory</span>
<span class="co">#&gt; Warning in normalizePath(temp_dir): path[1]="/tmp/Rtmp9HOVug/temp": No such file</span>
<span class="co">#&gt; or directory</span></code></pre></div>
<p>The <code>log_dir</code> argument has also been specified. See the final section for details on request logging by the API.</p>
<p>Running the API in the background returns a <code>callr</code> package <code>process</code> object. We can test the status of the background process in which the API is running using:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">api</span><span class="op">$</span><span class="fu">is_alive</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>To test the API from the client side, the <code><a href="../reference/extant.html">extant()</a></code> function can be used to test if the API is live.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/extant.html">extant</a></span><span class="op">(</span><span class="va">grover_host</span><span class="op">)</span>
<span class="co">#&gt; [1] "I'm still here!"</span></code></pre></div>
<p>For further details on client-side access to the hosted mass spectrometry data, see the <a href="client-usage.html">Accessing raw mass spectrometry data from a grover API</a> vignette.</p>
<p>Finally, the background API process can be terminated using:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">api</span><span class="op">$</span><span class="fu">kill</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Further details on options for securely deploying web APIs can be found as part of the <code>plumber</code> package documentation <a href="https://www.rplumber.io/articles/hosting.html" class="external-link">here</a>.</p>
</div>
<div class="section level2">
<h2 id="request-logging">Request logging<a class="anchor" aria-label="anchor" href="#request-logging"></a>
</h2>
<p>The <code>log_dir</code> argument can also be found in the call to <code><a href="../reference/groverAPI.html">groverAPI()</a></code> in the previous section. In this example, the <code>logs</code> directory within the temporary directory has been specified. The snippet below can be used to identify the log files generated by our API request.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">logs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">'/logs'</span><span class="op">)</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">logs</span>
<span class="co">#&gt; [1] "/tmp/Rtmp9HOVug/logs/plumber_36ab379f60ea.log"</span></code></pre></div>
<p>The contents of this log file can be access as below:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">logs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] "INFO [2022-02-01 13:00:08] GET /extant 1234 200 0.086"</span></code></pre></div>
<p>The log entry above shows our single request using <code><a href="../reference/extant.html">extant()</a></code> whilst the API was live. This log entry also includes, in order of appearance, the data and time of the request, the request type, the requested function, the <code>auth</code> argument specified, the status of the request and the processing time of the request.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jasen Finch.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
