<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hosting a grover API • grover</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Hosting a grover API">
<meta property="og:description" content="grover">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">grover</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/client-usage.html">Accessing raw mass spectrometry data from a grover API</a>
    </li>
    <li>
      <a href="../articles/hosting.html">Hosting a grover API</a>
    </li>
    <li>
      <a href="../articles/introduction.html">Introduction to grover</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/jasenfinch/grover/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="hosting_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Hosting a grover API</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/jasenfinch/grover/blob/master/vignettes/hosting.Rmd"><code>vignettes/hosting.Rmd</code></a></small>
      <div class="hidden name"><code>hosting.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>This vignette outlines the steps required for hosting a web API for providing web access to a mass spectrometry data repository. This includes the repository structure, specifying the host configuration, running the API and request logging.</p>
<p>To get started we can first load the <code>grover</code> package.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://jasenfinch.github.io/grover/">grover</a></span><span class="op">)</span></code></pre></div>
</div>
<div id="data-repository-structure" class="section level2">
<h2 class="hasAnchor">
<a href="#data-repository-structure" class="anchor"></a>Data repository structure</h2>
<p>The structure of the data repository should consist of a hierarchy of directories within a central data repository directory. The structure is outlined below.</p>
<pre><code>repository
└──instrument
   └──experiment
      └──sample.raw</code></pre>
<p>Within the central data repository directory are instrument directories specifying the mass spectrometers from which the data were generated. Within these instrument directories, the data should be organised into directories for each experiment. The experiment directories should then contain the <code>.raw</code> mass spectrometry data files and any other associated files such meta information or instrument methods.</p>
</div>
<div id="configuration" class="section level2">
<h2 class="hasAnchor">
<a href="#configuration" class="anchor"></a>Configuration</h2>
<p>In order to activate the API, we first need to specify the host details. This can be done in two ways. The primary method is through the use of a configuration file that can then be parsed and specified when the API is activated. This should be in YAML format and have the structure shown below:</p>
<pre><code>host: 127.0.0.1
port: 8000
auth: 1234
repository: ./data</code></pre>
<p>This specifies the host address, the port, and authentication key for data security and the host system directory path to the data repository.</p>
<p>The package contains an example file that we can parse here using the <code><a href="../reference/readGrover.html">readGrover()</a></code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grover_host</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/readGrover.html">readGrover</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">'grover_host.yml'</span>,package <span class="op">=</span> <span class="st">'grover'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>This returns an S4 object of class <code>GroverHost</code> that contains the API host information. The host information can be viewed by printing the object:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">grover_host</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Grover Information</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Host:         127.0.0.1 </span>
<span class="co">#&gt; Port:         8000 </span>
<span class="co">#&gt; Authentication:   1234 </span>
<span class="co">#&gt; Repository:   ./data</span></code></pre></div>
<p>The second method, and the method that will be used for this example, is to specify the host details directly using the <code><a href="../reference/grover.html">grover()</a></code> function like the following:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">grover_host</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/grover.html">grover</a></span><span class="op">(</span>host <span class="op">=</span> <span class="st">"127.0.0.1"</span>,
                     port <span class="op">=</span> <span class="fl">8000</span>,
                     auth <span class="op">=</span> <span class="st">"1234"</span>,
                     repository <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html">system.file</a></span><span class="op">(</span><span class="st">'repository'</span>,
                                              package <span class="op">=</span> <span class="st">'grover'</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>This enables us to host the example data repository included in the package.</p>
</div>
<div id="running-the-api" class="section level2">
<h2 class="hasAnchor">
<a href="#running-the-api" class="anchor"></a>Running the API</h2>
<p>The API can be activated using <code><a href="../reference/groverAPI.html">groverAPI()</a></code>. For the purposes of this example, the <code>background</code> argument will also be specified as <code>TRUE</code> to enable the API to be run in a background process. This will enable us to interact with the API without having to move to an alternative R console. Run the following to start the API:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">api</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/groverAPI.html">groverAPI</a></span><span class="op">(</span><span class="va">grover_host</span>,
                 background <span class="op">=</span> <span class="cn">TRUE</span>,
                 log_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">'/logs'</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Warning in normalizePath(log_dir): path[1]="/tmp/RtmpNnVrHL/logs": No such file</span>
<span class="co">#&gt; or directory</span></code></pre></div>
<p>The <code>log_dir</code> argument has also been specified. See the final section for details on request logging by the API.</p>
<p>Running the API in the background returns a <code>callr</code> package <code>process</code> object. We can test the status of the background process in which the API is running using:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">api</span><span class="op">$</span><span class="fu">is_alive</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>To test the API from the client side, the <code><a href="../reference/extant.html">extant()</a></code> function can be used to test if the API is live.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/extant.html">extant</a></span><span class="op">(</span><span class="va">grover_host</span><span class="op">)</span>
<span class="co">#&gt; [1] "I'm still here!"</span></code></pre></div>
<p>For further details on client-side access to the hosted mass spectrometry data, see the <a href="client-usage.html">Accessing raw mass spectrometry data from a grover API</a> vignette.</p>
<p>Finally, the background API process can be terminated using:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">api</span><span class="op">$</span><span class="fu">kill</span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>Further details on options for securely deploying web APIs can be found as part of the <code>plumber</code> package documentation <a href="https://www.rplumber.io/articles/hosting.html">here</a>.</p>
</div>
<div id="request-logging" class="section level2">
<h2 class="hasAnchor">
<a href="#request-logging" class="anchor"></a>Request logging</h2>
<p>The <code>log_dir</code> argument can also be found in the call to <code><a href="../reference/groverAPI.html">groverAPI()</a></code> in the previous section. In this example, the <code>logs</code> directory within the temporary directory has been specified. The snippet below can be used to identify the log files generated by our API request.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">logs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html">list.files</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html">tempdir</a></span><span class="op">(</span><span class="op">)</span>,<span class="st">'/logs'</span><span class="op">)</span>,full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="va">logs</span>
<span class="co">#&gt; [1] "/tmp/RtmpNnVrHL/logs/plumber_c06e5f1c99ad.log"</span></code></pre></div>
<p>The contents of this log file can be access as below:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/readLines.html">readLines</a></span><span class="op">(</span><span class="va">logs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; [1] "INFO [2021-01-12 11:30:10] GET /extant 1234 200 0.068"</span></code></pre></div>
<p>The log entry above shows our single request using <code><a href="../reference/extant.html">extant()</a></code> whilst the API was live. This log entry also includes, in order of appearance, the data and time of the request, the request type, the requested function, the <code>auth</code> argument specified, the status of the request and the processing time of the request.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jasen Finch.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
